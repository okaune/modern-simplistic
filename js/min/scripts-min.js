!function($){$.fn.justifiedGallery=function(e){function t(e,t,i){var n;return n=e>t?e:t,100>=n?i.settings.sizeRangeSuffixes.lt100:240>=n?i.settings.sizeRangeSuffixes.lt240:320>=n?i.settings.sizeRangeSuffixes.lt320:500>=n?i.settings.sizeRangeSuffixes.lt500:640>=n?i.settings.sizeRangeSuffixes.lt640:i.settings.sizeRangeSuffixes.lt1024}function i(e){var t=$(e.currentTarget).find(".caption");e.data.settings.cssAnimation?t.addClass("caption-visible").removeClass("caption-hidden"):t.stop().fadeTo(e.data.settings.captionsAnimationDuration,e.data.settings.captionsVisibleOpacity)}function n(e){var t=$(e.currentTarget).find(".caption");e.data.settings.cssAnimation?t.removeClass("caption-visible").removeClass("caption-hidden"):t.stop().fadeTo(e.data.settings.captionsAnimationDuration,0)}function s(e,s,a,o,r,g,l){var f=e.find("img");f.css("width",o),f.css("height",r),f.css("margin-left",-o/2),f.css("margin-top",-r/2),e.width(o),e.height(g),e.css("top",a),e.css("left",s);var d=f.attr("src"),u=d.replace(l.settings.extension,"").replace(l.usedSizeRangeRegExp,"")+t(o,r,l)+d.match(l.settings.extension)[0];f.one("error",function(){f.attr("src",f.data("jg.originalSrc"))});var h=function(){d!==u&&f.attr("src",u)};l.settings.cssAnimation?(e.addClass("entry-visible"),h()):e.stop().fadeTo(l.settings.imagesAnimationDuration,1,h);var c=e.data("jg.captionMouseEvents");if(l.settings.captions===!0){var p=e.find(".caption");if(0===p.length){var m=f.attr("alt");"undefined"==typeof m&&(m=e.attr("title")),"undefined"!=typeof m&&(p=$('<div class="caption">'+m+"</div>"),e.append(p))}0!==p.length&&"undefined"==typeof c&&(c={mouseenter:i,mouseleave:n},e.on("mouseenter",void 0,l,c.mouseenter),e.on("mouseleave",void 0,l,c.mouseleave),e.data("jg.captionMouseEvents",c))}else"undefined"!=typeof c&&(e.off("mouseenter",void 0,l,c.mouseenter),e.off("mouseleave",void 0,l,c.mouseleave),e.removeData("jg.captionMouseEvents"))}function a(e,t){var i,n,s,a,o,r,g=!0,l=0,f=e.galleryWidth,d=f-e.buildingRow.width-(e.buildingRow.entriesBuff.length-1)*e.settings.margins;if(t&&"hide"===e.settings.lastRow&&d/f>e.settings.justifyThreshold){for(i=0;i<e.buildingRow.entriesBuff.length;i++)n=e.buildingRow.entriesBuff[i],e.settings.cssAnimation?n.removeClass("entry-visible"):n.stop().fadeTo(0,0);return-1}for(t&&"nojustify"===e.settings.lastRow&&d/f>e.settings.justifyThreshold&&(g=!1),i=0;i<e.buildingRow.entriesBuff.length;i++)s=e.buildingRow.entriesBuff[i].find("img"),a=Math.ceil(s.data("jg.imgw")/(s.data("jg.imgh")/e.settings.rowHeight)),g?(o=i<e.buildingRow.entriesBuff.length-1?a+Math.ceil(a/e.buildingRow.width*d):f,r=Math.ceil(e.settings.rowHeight*(o/a)),e.settings.fixedHeight&&r<e.settings.rowHeight&&(o=a,r=e.settings.rowHeight)):(o=a,r=e.settings.rowHeight),s.data("jg.imgw",o),s.data("jg.imgh",r),f-=o+(i<e.buildingRow.entriesBuff.length-1?e.settings.margins:0),(0===i||l>r)&&(l=r);return e.settings.fixedHeight&&(l=e.settings.rowHeight),l}function o(e){e.lastAnalyzedIndex=-1,e.buildingRow.entriesBuff=[],e.buildingRow.width=0,e.offY=0,e.firstRowFlushed=!1}function r(e,t){var i,n,o,r=0;if(o=a(e,t),t&&"hide"===e.settings.lastRow&&-1===o)return e.buildingRow.entriesBuff=[],void(e.buildingRow.width=0);e.settings.maxRowHeight>0&&e.settings.maxRowHeight<o?o=e.settings.maxRowHeight:0===e.settings.maxRowHeight&&1.5*e.settings.rowHeight<o&&(o=1.5*e.settings.rowHeight);for(var g=0;g<e.buildingRow.entriesBuff.length;g++)i=e.buildingRow.entriesBuff[g],n=i.find("img"),s(i,r,e.offY,n.data("jg.imgw"),n.data("jg.imgh"),o,e),r+=n.data("jg.imgw")+e.settings.margins;e.$gallery.height(e.offY+o+(e.spinner.active?e.spinner.$el.innerHeight():0)),t||(e.offY+=o+e.settings.margins,e.buildingRow.entriesBuff=[],e.buildingRow.width=0,e.firstRowFlushed=!0,e.$gallery.trigger("jg.rowflush"))}function g(e){e.checkWidthIntervalId=setInterval(function(){var t=parseInt(e.$gallery.width(),10);e.galleryWidth!==t&&(e.galleryWidth=t,o(e),u(e,!0))},e.settings.refreshTime)}function l(e){clearInterval(e.intervalId),e.intervalId=setInterval(function(){e.phase<e.$points.length?e.$points.eq(e.phase).fadeTo(e.timeslot,1):e.$points.eq(e.phase-e.$points.length).fadeTo(e.timeslot,0),e.phase=(e.phase+1)%(2*e.$points.length)},e.timeslot)}function f(e){clearInterval(e.intervalId),e.intervalId=null}function d(e){e["yield"].flushed=0,null!==e.imgAnalyzerTimeout&&clearTimeout(e.imgAnalyzerTimeout)}function u(e,t){d(e),e.imgAnalyzerTimeout=setTimeout(function(){h(e,t)},.001),h(e,t)}function h(e,t){for(var i,n=e.lastAnalyzedIndex+1;n<e.entries.length;n++){var s=$(e.entries[n]),a=s.find("img");if(a.data("jg.loaded")===!0){var o=Math.ceil(a.data("jg.imgw")/(a.data("jg.imgh")/e.settings.rowHeight));if(i=e.firstRowFlushed&&n>=e.entries.length-1,e.buildingRow.width+(e.settings.fixedHeight?o:o/2)+(e.buildingRow.entriesBuff.length-1)*e.settings.margins>e.galleryWidth&&(r(e,i),++e["yield"].flushed>=e["yield"].every))return void u(e,t);e.buildingRow.entriesBuff.push(s),e.buildingRow.width+=o,e.lastAnalyzedIndex=n}else if("error"!==a.data("jg.loaded"))return}e.buildingRow.entriesBuff.length>0&&r(e,e.firstRowFlushed),e.spinner.active&&(e.spinner.active=!1,e.$gallery.height(e.$gallery.height()-e.spinner.$el.innerHeight()),e.spinner.$el.detach(),f(e.spinner)),d(e),t?e.$gallery.trigger("jg.resize"):e.$gallery.trigger("jg.complete")}function c(e){function t(t){if("string"!=typeof e.settings.sizeRangeSuffixes[t])throw"sizeRangeSuffixes."+t+" must be a string"}function i(t){if("string"==typeof e.settings[t]){if(e.settings[t]=parseFloat(e.settings[t],10),isNaN(e.settings[t]))throw"invalid number for "+t}else{if("number"!=typeof e.settings[t])throw t+" must be a number";if(isNaN(e.settings[t]))throw"invalid number for "+t}}if("object"!=typeof e.settings.sizeRangeSuffixes)throw"sizeRangeSuffixes must be defined and must be an object";if(t("lt100"),t("lt240"),t("lt320"),t("lt500"),t("lt640"),t("lt1024"),i("rowHeight"),i("maxRowHeight"),i("margins"),"nojustify"!==e.settings.lastRow&&"justify"!==e.settings.lastRow&&"hide"!==e.settings.lastRow)throw'lastRow must be "nojustify", "justify" or "hide"';if(i("justifyThreshold"),e.settings.justifyThreshold<0||e.settings.justifyThreshold>1)throw"justifyThreshold must be in the interval [0,1]";if("boolean"!=typeof e.settings.cssAnimation)throw"cssAnimation must be a boolean";if(i("captionsAnimationDuration"),i("imagesAnimationDuration"),i("captionsVisibleOpacity"),e.settings.captionsVisibleOpacity<0||e.settings.captionsVisibleOpacity>1)throw"captionsVisibleOpacity must be in the interval [0,1]";if("boolean"!=typeof e.settings.fixedHeight)throw"fixedHeight must be a boolean";if("boolean"!=typeof e.settings.captions)throw"captions must be a boolean";if(i("refreshTime"),"boolean"!=typeof e.settings.randomize)throw"randomize must be a boolean"}var p={sizeRangeSuffixes:{lt100:"",lt240:"",lt320:"",lt500:"",lt640:"",lt1024:""},rowHeight:360,maxRowHeight:-1,margins:1,lastRow:"justify",justifyThreshold:.35,cssAnimation:!1,captionsAnimationDuration:500,captionsVisibleOpacity:.7,imagesAnimationDuration:300,fixedHeight:!1,captions:!1,rel:null,target:null,extension:/\.[^.]+$/,refreshTime:250,randomize:!1};return this.each(function(t,i){var n=$(i);n.addClass("justified-gallery");var s=n.data("jg.context");if("undefined"==typeof s){if("undefined"!=typeof e&&null!==e&&"object"!=typeof e)throw"The argument must be an object";var a=$('<div class="spinner"><span></span><span></span><span></span></div>');s={settings:$.extend({},p,e),imgAnalyzerTimeout:null,entries:null,buildingRow:{entriesBuff:[],width:0},lastAnalyzedIndex:-1,firstRowFlushed:!1,"yield":{every:2,flushed:0},offY:0,spinner:{active:!1,phase:0,timeslot:150,$el:a,$points:a.find("span"),intervalId:null},checkWidthIntervalId:null,galleryWidth:n.width(),$gallery:n},n.data("jg.context",s)}else"norewind"===e||(s.settings=$.extend({},s.settings,e),o(s));if(c(s),s.entries=n.find("> a, > div").toArray(),0!==s.entries.length){s.settings.randomize&&(s.entries.sort(function(){return 2*Math.random()-1}),$.each(s.entries,function(){$(this).appendTo(n)})),s.usedSizeRangeRegExp=new RegExp("("+s.settings.sizeRangeSuffixes.lt100+"|"+s.settings.sizeRangeSuffixes.lt240+"|"+s.settings.sizeRangeSuffixes.lt320+"|"+s.settings.sizeRangeSuffixes.lt500+"|"+s.settings.sizeRangeSuffixes.lt640+"|"+s.settings.sizeRangeSuffixes.lt1024+")$"),s.settings.maxRowHeight>0&&s.settings.maxRowHeight<s.settings.rowHeight&&(s.settings.maxRowHeight=s.settings.rowHeight);var r=!1;$.each(s.entries,function(e,t){var i=$(t),a=i.find("img");if(a.data("jg.loaded")!==!0){a.data("jg.loaded",!1),r=!0,s.spinner.active===!1&&(s.spinner.active=!0,n.append(s.spinner.$el),n.height(s.offY+s.spinner.$el.innerHeight()),l(s.spinner)),null!==s.settings.rel&&i.attr("rel",s.settings.rel),null!==s.settings.target&&i.attr("target",s.settings.target);var o="undefined"!=typeof a.data("safe-src")?a.data("safe-src"):a.attr("src");a.data("jg.originalSrc",o),a.attr("src",o);var g=new Image,f=$(g);f.one("load",function d(){a.off("load error"),a.data("jg.imgw",g.width),a.data("jg.imgh",g.height),a.data("jg.loaded",!0),u(s,!1)}),f.one("error",function h(){a.off("load error"),a.data("jg.loaded","error"),u(s,!1)}),g.src=o}}),r||u(s,!1),g(s)}})}}(jQuery),$(document).ready(function(){function e(){var e=$(window).scrollTop(),t=$("#profile").offset().top+30-i;e>t?($("header").css({"box-shadow":"1px 1px 10px #aaaaaa"}),$("header a").css({"line-height":"60px"})):($("header").css({"box-shadow":"none"}),$("header a").css({"line-height":"90px"}))}var t=$("html, body"),i=$("header.mainheader").height();$("a.more").click(function(e){e.preventDefault();var n=$(this).attr("href"),s=$(n).offset().top-i;t.animate({scrollTop:s},500,function(){window.location.hash=""+n,t.animate({scrollTop:s},0)})}),$window=$(window),$('section[data-type="background"]').each(function(){var e=$(this);$(window).scroll(function(){var t=-($window.scrollTop()/e.data("speed")),i="50% "+t+"px";e.css({backgroundPosition:i})})}),$(function(){$(window).scroll(e),e()}),0==$("#profile").length&&$(window).scroll(function(){$(this).scrollTop()>=30?($("header").css({"box-shadow":"1px 1px 10px #aaaaaa"}),$("header a").css({"line-height":"60px"})):($("header").css({"box-shadow":"none"}),$("header a").css({"line-height":"90px"}))})});